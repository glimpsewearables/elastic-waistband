<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>{{this_event.name}}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<style>
*{
    margin: 0px;
    padding: 0px;
}
#headerImage{
    width: 100%;
}
.singleVideo{
    width: 100%;
}
.videoContainer{
    width: 32%;
    margin-left: .5%;
    display: inline-block;
}
@media only screen and (max-width: 600px) {
    .videoContainer {
        width: 95%;
        display: inline-block;
    }
    .featureButton{
        width: 100%;
        font-size: 10px;
    }
}
@media only screen and (max-width: 600px) {
    .videoContainer{
        width: 100%;
    }
    .changeButton{
        height: 30px;
    }
} 
#contentContainer{
    width: 100%;
}
.featureButton{
    width: 40%;
    background-color: #212529;
    color: gray;
    border-radius: 4px;
}
.changeButton{
    width: 40%;
    background-color: #212529;
    color: gray;
    border: none;
    border-radius: 4px;
}
.buttons{
    display: flex
}
.blink_me {
  animation: blinker 1.5s linear infinite;
  background-color: #888;
  border-radius: 3px;
}

@keyframes blinker {
  50% {
    opacity: 0.2;
  }
}
#stickyHeader{
    position: fixed;
    top: 0;
    width: 100%;
}
.loadingContainer {
    position: absolute;
    width: 10%;
    height: auto;
    top:50%;
    left:45%;
    text-align:center;
}
.loadingContainer .loadingSpan {
    display: block;
    position: absolute;
    bottom: 0;
    width: 4px;
    height: 10px;
    left: 0px;
    background: #FF5722;
    animation: loading 1.9s infinite ease-in-out
}
.loadingSpan:nth-of-type(2) {
  left: 11px;
  animation-delay: .2s;
}

.loadingSpan:nth-of-type(3) {
  left: 22px;
  animation-delay: .3s;
}

.loadingSpan:nth-of-type(4) {
  left: 33px;
  animation-delay: .4s;
}
.loadingSpan:nth-of-type(5) {
  left: 44px;
  animation-delay: .5s;
}
.loadingSpan:nth-of-type(6) {
  left: 55px;
  animation-delay: .4s;
}

.loadingSpan:nth-of-type(7) {
  left: 66px;
  animation-delay: .3s;
}

.loadingSpan:nth-of-type(8) {
  left: 77px;
  animation-delay: .2s;
}
.loadingSpan:nth-of-type(9) {
  left: 88px;
  animation-delay: .3s;
}
.loadingSpan:nth-of-type(10) {
  left: 99px;
  animation-delay: .4s;
}
.loadingSpan:nth-of-type(11) {
  left: 110px;
  animation-delay: .5s;
}
.loadingSpan:nth-of-type(12) {
  left: 121px;
  animation-delay: .4s;
}
.loadingSpan:nth-of-type(13) {
  left: 132px;
  animation-delay: .3s;
}
.loadingSpan:nth-of-type(14) {
  left: 143px;
  animation-delay: .2s;
}
.loadingSpan:nth-of-type(15) {
  left: 154px;
  animation-delay: .3s;
}
.loadingSpan:nth-of-type(16) {
  left: 165px;
  animation-delay: .4s;
}
.loadingSpan:nth-of-type(17) {
  left: 176px;
  animation-delay: .5s;
}
.loadingSpan:nth-of-type(18) {
  left: 187px;
  animation-delay: .4s;
}
.loadingSpan:nth-of-type(19) {
  left: 198px;
  animation-delay: .3s;
}
.loadingSpan:last-of-type {
  left: 209px;
  animation-delay: .2s;
}
@keyframes loading {
  0%, 25%, 100% {
    background: #FF5722;
    height: 50px;
    transform: translateY(0);
    box-shadow: 0 0 3px rgba(0, 0, 0, 0.1)
  }
  
  50% {
    background: #FF9800;
    height: 110px;
    transform: translateY(15px);
    
    box-shadow: 0 20px 3px rgba(0, 0, 0, 0.1)
  }
  
}
.hiddenOnLoad{
    opacity: 0.0;
    transition-duration: 1s;
}
.showContainer{
    transition-duration: 1s;
    -webkit-animation: fadein 2s; /* Safari, Chrome and Opera > 12.1 */
       -moz-animation: fadein 2s; /* Firefox < 16 */
        -ms-animation: fadein 2s; /* Internet Explorer */
         -o-animation: fadein 2s; /* Opera < 12.1 */
            animation: fadein 2s;
}
@keyframes fadein {
    from { opacity: 0; }
    to   { opacity: 1; }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from { opacity: 0; }
    to   { opacity: 1; }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from { opacity: 0; }
    to   { opacity: 1; }
}

/* Internet Explorer */
@-ms-keyframes fadein {
    from { opacity: 0; }
    to   { opacity: 1; }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from { opacity: 0; }
    to   { opacity: 1; }
}
</style>
<body>
<div style="z-index:5;" id="stickyHeader" class="hiddenOnLoad">
    {% include 'header.html'  %}
</div>
<div class="loadingContainer" id="loadingAnimation">
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
</div>
    <div id="mainContainer" class="hiddenOnLoad">
        <div id="navBarHeader">
            <input id="eventIdValue" value="{{this_event.id}}" type="hidden">
            <input id="userIdValue" value="{{this_user.id}}" type="hidden">
        </div>
        <div id="eventHeader">
            <!-- <img id="headerImage" src="{{this_event.header_image}}"> -->
            <h2 style="text-align: center" id="headerImage">{{this_event.name}}</h2>
        </div>
        <div id="contentContainer">
            {% for this_media in media %}
            {% csrf_token %}
            <div class="videoContainer">
                <video id="video{{this_media.id}}" class="singleVideo" controls onclick="playVideo('video{{this_media.id}}')">
                    <source src="{{this_media.link}}" type="video/mp4">
                </video>
                <div class="buttons">
                    <input style="text-align:center;" type="number" max="5" min="0" value="{{this_media.user_rating}}" id="videoCur{{this_media.id}}" class="changeButton" onclick="inputTouch('{{this_media.id}}')">
                    <button class="changeButton" id="changeButton{{this_media.id}}" onclick="updateCuratorMediaRating('{{this_media.id}}')">Change</button>
                    <button class="changeButton" id="media{{this_media.id}}Button" onclick="featureThisMedia('{{this_media.id}}')">Favorite</button>
                </div>
            </div>
            {% endfor %}
        </div>
        <div id="footer">

        </div>
    </div>
</body>
<script>
    function showPage(){
        var allHidden = document.getElementsByClassName("hiddenOnLoad");
        console.log(allHidden)
        for(var i = 0; i < allHidden.length; i++){
            var entireContainer = allHidden[i];
            entireContainer.classList.add("showContainer");
            entireContainer.classList.remove("hiddenOnLoad")
        }
        var mainContainer = document.getElementById("mainContainer");
        mainContainer.classList.add("showContainer");
        mainContainer.classList.remove("hiddenOnLoad");
        var loadingAnimation = document.getElementById("loadingAnimation");
        loadingAnimation.classList.add("hiddenOnLoad");
    }
    setTimeout(showPage, 2000);
    var videoIsPlaying = false;
    function playVideo(videoIdElement) { 
        var vid = document.getElementById(videoIdElement);
        if(videoIsPlaying == true){
            vid.pause();
            videoIsPlaying = false;
        } else{
            vid.play();
            videoIsPlaying = true;
        }
    } 
    function featureThisMedia(media_id){
        addFeaturedTpAPI(media_id);
        addFeaturedTpAPI(media_id);
        var button = document.getElementById("media" + media_id + "Button");
        button.innerHTML = "reload page";
        button.style.backgroundColor ="transparent";
    }
    function unfeatureThisMedia(media_id){
        removeFeaturedToAPI(media_id);
        removeFeaturedToAPI(media_id);
        var button = document.getElementById("media" + media_id + "ButtonFeat");
        button.innerHTML = "reload page";
        button.style.backgroundColor ="transparent";
    }
    const Http = new XMLHttpRequest();
    function addFeaturedTpAPI(media_id){
        const media_url = "https://api.glimpsewearables.com/api/media/";
        const media_url_id = media_url + media_id + "/";
        console.log(media_url_id);
        var data = Http.open("PATCH", media_url_id, true);
        Http.setRequestHeader('Content-type', 'application/json');
        old_data = {
            "featured": 1
        }
        put_data = JSON.stringify(old_data);
        Http.send(put_data);
    }
    function removeFeaturedToAPI(media_id){
        const media_url = "https://api.glimpsewearables.com/api/media/";
        const media_url_id = media_url + media_id + "/";
        console.log(media_url_id);
        var data = Http.open("PATCH", media_url_id, true);
        Http.setRequestHeader('Content-type', 'application/json');
        old_data = {
            "featured": 0
        }
        put_data = JSON.stringify(old_data);
        Http.send(put_data);
    }
    function inputTouch(mediaId){
        var button = document.getElementById("changeButton" + mediaId);
        button.classList.add("blink_me");
    }
    function updateCuratorMediaRating(mediaId){
        var curatorRanking = document.getElementById("videoCur" + mediaId);
        var button = document.getElementById("changeButton" + mediaId);
        button.classList.remove("blink_me");
        var value = curatorRanking.value;
        updateMediaCuratorAPI(mediaId, value);
    }
    function updateMediaCuratorAPI(media_id, new_curator_rating){
        const media_url = "https://api.glimpsewearables.com/api/media/";
        // const media_url = "http://localhost:8000/api/media/";
        const media_url_id = media_url + media_id + "/";
        console.log(media_url_id);
        var data = Http.open("PATCH", media_url_id, true);
        Http.setRequestHeader('Content-type', 'application/json');
        old_data = {
            "user_rating": new_curator_rating
        }
        put_data = JSON.stringify(old_data);
        Http.send(put_data);
    }
    function scrollToContent(){
        var headerHeight = document.getElementById("headerImage");
        window.scrollTo({
            top: headerHeight.clientHeight,
            left: 0,
            behavior: "smooth"    
        });
    }
    if(window.attachEvent) {
        window.attachEvent('onload', scrollToContent);
    } else {
        if(window.onload) {
            var curronload = window.onload;
            var newonload = function(evt) {
                curronload(evt);
                scrollToContent(evt);
            };
            window.onload = newonload;
        } else {
            window.onload = scrollToContent;
        }
    }
</script>
</html>