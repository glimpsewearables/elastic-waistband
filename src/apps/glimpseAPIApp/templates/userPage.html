<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Glimpse</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    {% load static from staticfiles%}
    <script type="text/javascript" src="{% static 'js/main.js' %}"></script>
    <LINK REL="SHORTCUT ICON" HREF="{% static 'img/clipcamicon.png' %}" >
</head>
<style>
*{
    font-family: 'Fjalla One', Arial, sans-serif;
}
body{
    background: #666;
    width: 100%;
    height: 100%;
    font-family: 'Fjalla One', Arial, sans-serif;
}
a{
   color: #212529;
}
a:hover{
    color: black;
}
button{
    border: none;
    outline:none;
}

.headerStyle{
    position: fixed;
    top: 0;
    height: 3%;
    width: 100%;
}
.eventHeaderImage{
    width: 100%l
}
.headerButton{
    background-color: #212529;
    color: #ccc;
    float: right;
    border-radius: 5px;
}
.headerButton:hover{
    opacity: 0.7;
}
.scrollToButton{
    background: #212529;
    color: #ccc;
    text-align: center;
}
#contentContainer{
    width: 70%;
    height: 70%;
    margin: 15%;
    top: 0;
    position: fixed;
    background-color: yellow;
    display: none;
}
.displayEventVid{
    width: 100%;
}
.singleVideo{
    width: 100%;
}
@media only screen and (max-width: 600px) {
    .videoContainer{
        width: 49%;
        margin: 0;
        display: inline-block;
    }
    .featureButton{
        width: 100%;
        font-size: 10px;
    }
}
.videoContainer{
    width: 32%;
    margin-left: .5%;
    display: inline-block;
}
.featureButton{
    width: 100%;
    background-color: #212529;
    color: gray;
    border: none;
    border-radius: 4px;
    height: 40px;
    margin-top: -4px;
    margin-bottom: 15px;
}
.eventHeaderImage{
    width: 50%;
    transition-duration: 0.5s;
}
.eventHeaderImage:hover{
    opacity: 0.7;
    transition: 0.5s;
}
.eventHeaderCaption{
    display: none; 
}
.left{
    position: absolute;
    left: 0
}
.right{
    position: absolute;
    right: 0
}
#allEventHeaders{
    width: 100%;
    display: inline;
}
.featureRecentButton{
    width: 50%;
    height: 40px;
    background-color: #212529;
    color: #888;
}
.featureFavoriteButton{
    position: absolute;
    right: 0px;
    width: 50%;
    height: 40px;
    background-color: #212529;
    color: #888;
}
button:hover{
    opacity: 0.8;
}
#allContent{
    position: absolute;
}
.hiddenOnLoad{
    display: none;
}
.centered{
    width: 100%;
}
#stickyHeader{
    position: fixed;
    top: 0;
    width: 100%;
}
.loadingContainer {
    position: absolute;
    width: 10%;
    height: auto;
    top:50%;
    left:45%;
    text-align:center;
}
.loadingContainer .loadingSpan {
    display: block;
    position: absolute;
    bottom: 0;
    width: 4px;
    height: 10px;
    left: 0px;
    background: #FF5722;
    animation: loading 1.9s infinite ease-in-out
}
.loadingSpan:nth-of-type(2) {
  left: 11px;
  animation-delay: .2s;
}

.loadingSpan:nth-of-type(3) {
  left: 22px;
  animation-delay: .3s;
}

.loadingSpan:nth-of-type(4) {
  left: 33px;
  animation-delay: .4s;
}
.loadingSpan:nth-of-type(5) {
  left: 44px;
  animation-delay: .5s;
}
.loadingSpan:nth-of-type(6) {
  left: 55px;
  animation-delay: .4s;
}

.loadingSpan:nth-of-type(7) {
  left: 66px;
  animation-delay: .3s;
}

.loadingSpan:nth-of-type(8) {
  left: 77px;
  animation-delay: .2s;
}
.loadingSpan:nth-of-type(9) {
  left: 88px;
  animation-delay: .3s;
}
.loadingSpan:nth-of-type(10) {
  left: 99px;
  animation-delay: .4s;
}
.loadingSpan:nth-of-type(11) {
  left: 110px;
  animation-delay: .5s;
}
.loadingSpan:nth-of-type(12) {
  left: 121px;
  animation-delay: .4s;
}
.loadingSpan:nth-of-type(13) {
  left: 132px;
  animation-delay: .3s;
}
.loadingSpan:nth-of-type(14) {
  left: 143px;
  animation-delay: .2s;
}
.loadingSpan:nth-of-type(15) {
  left: 154px;
  animation-delay: .3s;
}
.loadingSpan:nth-of-type(16) {
  left: 165px;
  animation-delay: .4s;
}
.loadingSpan:nth-of-type(17) {
  left: 176px;
  animation-delay: .5s;
}
.loadingSpan:nth-of-type(18) {
  left: 187px;
  animation-delay: .4s;
}
.loadingSpan:nth-of-type(19) {
  left: 198px;
  animation-delay: .3s;
}
.loadingSpan:last-of-type {
  left: 209px;
  animation-delay: .2s;
}
@keyframes loading {
  0%, 25%, 100% {
    background: #FF5722;
    height: 50px;
    transform: translateY(0);
    box-shadow: 0 0 3px rgba(0, 0, 0, 0.1)
  }
  
  50% {
    background: #FF9800;
    height: 110px;
    transform: translateY(15px);
    
    box-shadow: 0 20px 3px rgba(0, 0, 0, 0.1)
  }
  
}
.hiddenOnLoad{
    opacity: 0.0;
    transition-duration: 1s;
}
.showContainer{
    transition-duration: 1s;
    -webkit-animation: fadein 2s; /* Safari, Chrome and Opera > 12.1 */
       -moz-animation: fadein 2s; /* Firefox < 16 */
        -ms-animation: fadein 2s; /* Internet Explorer */
         -o-animation: fadein 2s; /* Opera < 12.1 */
            animation: fadein 2s;
}
@keyframes fadein {
    from { opacity: 0; }
    to   { opacity: 1; }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from { opacity: 0; }
    to   { opacity: 1; }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from { opacity: 0; }
    to   { opacity: 1; }
}

/* Internet Explorer */
@-ms-keyframes fadein {
    from { opacity: 0; }
    to   { opacity: 1; }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from { opacity: 0; }
    to   { opacity: 1; }
}
</style>
<body>
<div style="z-index:5;" id="stickyHeader" class="hiddenOnLoad">
    {% include 'header.html'  %}
</div>
<div class="loadingContainer" id="loadingAnimation">
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
    <span class="loadingSpan"></span>
</div>
<div class="loadingContainer" id="loadingAnimationText">
    <div id="stage">
        <h1 id="letterAnimations"></h1>
    </div>
</div>
<div id="mainContainer" class="hiddenOnLoad">
    <h1 style="text-align: center;">Device {{device_number}}</h1>
    <div id="yourInformation">
        <input type="hidden" value="{{device_number}}" id="device_id_value">
    </div>
    <div class="allEvents">
        <button class="eventButton featureRecentButton" onclick="openEvent('mostRecent')">Recent</button>
        <button class="eventButton featureFavoriteButton" onclick="openEvent('featuredContent')">Favorited</button>
        <div id="allEventHeaders">
            {% for event in all_events %}
            {% csrf_token %}
            <div class="singleEventHeader">
                <input type="hidden" class="hiddenEventInfoId" value="{{event.id}}">
                <input type="hidden" id="hiddenEventInfoHeader{{event.id}}" value="{{event.header_image}}">
                <img src="{{event.header_image}}" onmouseover="addEventName('{{event.id}}')" onmouseout="removeEventName('{{event.id}}')" class="eventHeaderImage" id="event{{event.event_id}}Header" onclick="openEvent('{{event.event_id}}')">
                <h3 id="event{{event.id}}HeaderCaption" class="eventHeaderCaption">{{event.name}}</h3>
            </div>
            {% endfor %}
        </div>
    </div>
    <div class="allUsersContent" id="allContent">           
        {% csrf_token %}
            <div class="singleEventTab" id="mostRecent" style="display: none">
                <h2 style="text-align:center">Most Recent</h2>
                {% for video in most_recent %}
                <div class="videoContainer">
                    <video class="singleVideo mostRecentVideo" controls preload="metadata">
                        <source src="{{video.link}}" type="video/mp4">
                    </video>
                    <button class="featureButton" id="media{{video.id}}Button" onclick="featureThisMedia('{{video.id}}')">Favorite</button>
                </div>
                {% endfor %}
            </div>
            <div class="singleEventTab" id="featuredContent" style="display: none">
                <h2 style="text-align:center;">Your Favorite Content</h2>
                {% for video in featured %}
                <div class="videoContainer">
                    <video class="singleVideo featuredContentVideo" controls preload="metadata">
                        <source src="{{video.link}}" type="video/mp4">
                    </video>
                    <button class="featureButton" id="media{{video.id}}ButtonFeat" onclick="unfeatureThisMedia('{{video.id}}')">UnFavorite</button>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
</body>
<script>
    function showPage(){
        var allHidden = document.getElementsByClassName("hiddenOnLoad");
        console.log(allHidden)
        for(var i = 0; i < allHidden.length; i++){
            var entireContainer = allHidden[i];
            entireContainer.classList.add("showContainer");
            entireContainer.classList.remove("hiddenOnLoad")
        }
        var mainContainer = document.getElementById("mainContainer");
        mainContainer.classList.add("showContainer");
        mainContainer.classList.remove("hiddenOnLoad");
        var loadingAnimation = document.getElementById("loadingAnimation");
        fixEventHeaders();
        loadingAnimation.classList.add("hiddenOnLoad");
    }
    setTimeout(showPage, 4000);
    var allEventTabs = ['featuredContent', "mostRecent",]
    var allEventHeaders = []
    function getAllEvents(){
        var allEventIds = document.getElementsByClassName("hiddenEventInfoId");
        var lastInt = 0
        for(var i = 0; i < allEventIds.length; i++){
            var thisEventId = allEventIds[i].value;
            var thisEventHeader = document.getElementById("hiddenEventInfoHeader" + thisEventId.toString()).value;
            allEventTabs.push("event" + thisEventId.toString());
            allEventHeaders.push("event" + thisEventId.toString() + "Header");
            lastInt = i;
        }
        allEventTabs.push("event" + (lastInt + 1).toString());
        allEventHeaders.push("event" + (lastInt + 1).toString() + "Header");
    }
    getAllEvents();
    function openEvent(event_id){
        var user_id = document.getElementById("device_id_value").value;
        if(event_id == "mostRecent" || event_id == "featuredContent"){
            var eventOpeningName = event_id.toString();
        } else {
            window.location.href = "/usersEventPage/" + event_id.toString() + "/" + user_id.toString();
        }
        for(i = 0; i < allEventTabs.length; i++){
            if(eventOpeningName == allEventTabs[i]){
                document.getElementById(allEventTabs[i]).style.display = "block";
                window.scrollTo({
                    top: 1600,
                    left: 0,
                    behavior: "smooth"    
                });
                var theseVideos = document.getElementsByClassName(eventOpeningName + "Video");
                for(video in theseVideos){
                    video.preload;
                }
            } else {
                document.getElementById(allEventTabs[i]).style.display = "none"
            }
        }
    }
    function fixEventHeaders(){
        var lastLeftTop = 199;
        var trackLeft = 199;
        var lastRightTop = 199;
        var trackRight = 199;
        for(var i = 0; i < allEventHeaders.length - 1; i++){
            thisEventHeader = document.getElementById(allEventHeaders[i]);
            thisEventHeaderCaption = document.getElementById(allEventHeaders[i] + "Caption");
            thisHeight = thisEventHeader.height;
            if(i % 2 == 0){
                thisEventHeader.classList.add("left");
                thisEventHeaderCaption.classList.add("left");
                thisEventHeader.style.top = trackLeft.toString() + "px";
                thisEventHeaderCaption.style.top = trackLeft.toString() + "px";
                trackLeft += thisHeight;
            } else {
                thisEventHeader.classList.add("right");
                thisEventHeaderCaption.classList.add("right");
                thisEventHeader.style.top = trackRight.toString() + "px";
                thisEventHeaderCaption.style.top = trackRight.toString() + "px";
                trackRight += thisHeight;
            }
        }
        maxBottom = Math.max(trackLeft, trackRight);
        document.getElementById("allContent").style.top = maxBottom.toString() + "px";
    }
    window.onload = function () { 
        fixEventHeaders();
    }
    $( window ).resize(function() {
        fixEventHeaders();
    });
    function addEventName(eventId){
        var thisCaption = document.getElementById("event" + eventId + "HeaderCaption");
        thisCaption.style.transition = "opacity .5s";
        thisCaption.style.display = "block";
    }
    function removeEventName(eventId){
        var thisCaption = document.getElementById("event" + eventId + "HeaderCaption");
        thisCaption.style.transition = "opacity .5s";
        thisCaption.style.display = "none";
    }
    // Adding media to the featured section, or removing
    function featureThisMedia(media_id){
        addFeaturedTpAPI(media_id);
        addFeaturedTpAPI(media_id);
        var button = document.getElementById("media" + media_id + "Button");
        button.innerHTML = "reload page";
        button.style.backgroundColor ="transparent";
    }
    function unfeatureThisMedia(media_id){
        removeFeaturedToAPI(media_id);
        removeFeaturedToAPI(media_id);
        var button = document.getElementById("media" + media_id + "ButtonFeat");
        button.innerHTML = "reload page";
        button.style.backgroundColor ="transparent";
    }
    // Updating all the backend
    const Http = new XMLHttpRequest();
    function addFeaturedTpAPI(media_id){
        const media_url = "https://api.glimpsewearables.com/api/media/";
        const media_url_id = media_url + media_id + "/";
        console.log(media_url_id);
        var data = Http.open("PATCH", media_url_id, true);
        Http.setRequestHeader('Content-type', 'application/json');
        old_data = {
            "featured": 1
        }
        put_data = JSON.stringify(old_data);
        Http.send(put_data);
    }
    function removeFeaturedToAPI(media_id){
        const media_url = "https://api.glimpsewearables.com/api/media/";
        const media_url_id = media_url + media_id + "/";
        console.log(media_url_id);
        var data = Http.open("PATCH", media_url_id, true);
        Http.setRequestHeader('Content-type', 'application/json');
        old_data = {
            "featured": 0
        }
        put_data = JSON.stringify(old_data);
        Http.send(put_data);
    }

</script>
</html>